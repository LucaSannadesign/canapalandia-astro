<button type="button" class="theme-toggle__btn" data-theme-toggle aria-label="Cambia tema">
  <span class="sr-only">Cambia tema</span>

  <!-- Sole: visibile quando sei in DARK -->
  <svg class="theme-toggle__icon theme-toggle__icon--sun" viewBox="0 0 24 24" fill="none"
    xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z" stroke="currentColor" stroke-width="2"
      stroke-linecap="round" stroke-linejoin="round" />
    <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" />
  </svg>

  <!-- Luna: visibile quando sei in LIGHT -->
  <svg class="theme-toggle__icon theme-toggle__icon--moon" viewBox="0 0 24 24" fill="none"
    xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <path d="M21 13.2A8.5 8.5 0 1 1 10.8 3a6.8 6.8 0 0 0 10.2 10.2Z" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
  </svg>
</button>

<script is:inline>
  (() => {
    const key = 'canapalandia_theme';
    const root = document.documentElement;
    const btn = document.querySelector('[data-theme-toggle]');
    if (!btn) return;

    const safeGet = () => { try { return localStorage.getItem(key); } catch { return null; } };
    const safeSet = (v) => { try { localStorage.setItem(key, v); } catch {} };

    const systemPref = () =>
      window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';

    const normalize = (v) => (v === 'dark' || v === 'light') ? v : null;

    const apply = (theme) => {
      root.dataset.theme = theme;
      btn.setAttribute('aria-label', theme === 'dark' ? 'Passa a modalità chiara' : 'Passa a modalità scura');
    };

    // tema iniziale (saved > system)
    apply(normalize(root.dataset.theme) || normalize(safeGet()) || systemPref());

    btn.addEventListener('click', () => {
      const current = root.dataset.theme === 'dark' ? 'dark' : 'light';
      const next = current === 'dark' ? 'light' : 'dark';
      apply(next);
      safeSet(next);
    });
  })();
</script>